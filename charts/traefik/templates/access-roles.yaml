# Copyright 2019 Crown Copyright
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
    name: ingressroutes.traefik.containo.us
spec:
    group: traefik.containo.us
    versions:
        - name: v1alpha1
          served: true
          storage: true
    names:
        kind: IngressRoute
        plural: ingressroutes
        singular: ingressroute
    scope: Namespaced

---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
    name: ingressroutetcps.traefik.containo.us
spec:
    group: traefik.containo.us
    versions:
        - name: v1alpha1
          served: true
          storage: true
    names:
        kind: IngressRouteTCP
        plural: ingressroutetcps
        singular: ingressroutetcp
    scope: Namespaced

---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
    name: middlewares.traefik.containo.us
spec:
    group: traefik.containo.us
    versions:
        - name: v1alpha1
          served: true
          storage: true
    names:
        kind: Middleware
        plural: middlewares
        singular: middleware
    scope: Namespaced

---
apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
    name: tlsoptions.traefik.containo.us
spec:
    group: traefik.containo.us
    versions:
        - name: v1alpha1
          served: true
          storage: true
    names:
        kind: TLSOption
        plural: tlsoptions
        singular: tlsoption
    scope: Namespaced

---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
    name: traefik-ingress-controller
rules:
    - apiGroups:
          - ""
      resources:
          - services
          - endpoints
          - secrets
      verbs:
          - get
          - list
          - watch
    - apiGroups:
          - extensions
      resources:
          - ingresses
      verbs:
          - get
          - list
          - watch
    - apiGroups:
          - extensions
      resources:
          - ingresses/status
      verbs:
          - update
    - apiGroups:
          - traefik.containo.us
      resources:
          - middlewares
      verbs:
          - get
          - list
          - watch
    - apiGroups:
          - traefik.containo.us
      resources:
          - ingressroutes
      verbs:
          - get
          - list
          - watch
    - apiGroups:
          - traefik.containo.us
      resources:
          - ingressroutetcps
      verbs:
          - get
          - list
          - watch
    - apiGroups:
          - traefik.containo.us
      resources:
          - tlsoptions
      verbs:
          - get
          - list
          - watch

---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
    name: traefik-ingress-controller
roleRef:
    apiGroup: rbac.authorization.k8s.io
    kind: ClusterRole
    name: traefik-ingress-controller
subjects:
    - kind: ServiceAccount
      name: traefik-ingress-controller
      namespace: kube-system